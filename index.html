<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allianz Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #7c3aed;
            --accent: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            min-height: 100vh;
        }
        
        .light-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
            transition: all 0.3s ease;
        }
        
        .light-card:hover {
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            transform: translateY(-2px);
        }
        
        .light-nav {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-right: 1px solid rgba(226, 232, 240, 0.6);
        }
        
        .light-input {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            color: #1e293b;
            transition: all 0.3s ease;
        }
        
        .light-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .light-input::placeholder {
            color: #94a3b8;
        }
        
        .light-button {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.3s ease;
            color: var(--primary);
            font-weight: 500;
        }
        
        .light-button:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.1);
        }
        
        .primary-button {
            background: var(--primary);
            color: white;
            transition: all 0.3s ease;
        }
        
        .primary-button:hover {
            background: #4338ca;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        
        .light-table {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .light-modal {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 20px 40px rgba(15, 23, 42, 0.1);
        }
        
        .error-text {
            color: var(--error);
        }
        
        .success-text {
            color: var(--accent);
        }
        
        .warning-text {
            color: var(--warning);
        }
        
        .highlight-error {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .toast {
            animation: slideIn 0.5s, fadeOut 0.5s 2.5s forwards;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes fadeOut {
            to { opacity: 0; }
        }
        
        .blob {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.15;
            z-index: -1;
        }
        
        .blob-1 {
            background: var(--primary);
            top: 10%;
            left: 10%;
            animation: float 15s infinite ease-in-out;
        }
        
        .blob-2 {
            background: var(--secondary);
            bottom: 10%;
            right: 10%;
            animation: float 18s infinite ease-in-out reverse;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(50px, 50px); }
            50% { transform: translate(0, 100px); }
            75% { transform: translate(-50px, 50px); }
        }
        
        .nav-link {
            color: #64748b;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--primary);
            background: rgba(79, 70, 229, 0.05);
        }
        
        .nav-link.active {
            color: var(--primary);
            background: rgba(79, 70, 229, 0.1);
        }
        
        .sidebar-divider {
            border-color: rgba(226, 232, 240, 0.6);
        }
        
        .stat-card {
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Background blobs -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    
    <!-- Auth State -->
    <div id="auth-state" class="hidden"></div>
    
    <!-- Login Page -->
    <div id="login-page" class="min-h-screen flex items-center justify-center p-4">
        <div class="light-card p-8 rounded-2xl w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center bg-indigo-100 p-4 rounded-full mb-4">
                    <i class="fas fa-phone-alt text-2xl text-indigo-600"></i>
                </div>
                <h1 class="text-3xl font-bold text-slate-800">Allianz Dashboard</h1>
                <p class="text-slate-500 mt-2">Sign in to your account</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="email" class="block text-sm font-medium text-slate-700 mb-1">Email</label>
                    <input type="email" id="email" required
                         class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                    <input type="password" id="password" required
                         class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                </div>
                <div>
                    <button type="submit" class="primary-button w-full flex justify-center py-3 px-4 rounded-xl shadow-sm text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Sign in
                    </button>
                </div>
                <p class="text-sm text-center text-slate-500">
                    Test credentials: allianz@test.com / Test1234
                </p>
            </form>
        </div>
    </div>
    
    <!-- Main App (hidden by default) -->
    <div id="app-container" class="hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="light-nav fixed inset-y-0 left-0 w-64 shadow-lg">
            <div class="flex items-center justify-between p-6 border-b border-slate-200">
                <div class="flex items-center">
                    <div class="bg-indigo-100 p-2 rounded-lg mr-3">
                        <i class="fas fa-phone-alt text-indigo-600"></i>
                    </div>
                    <h1 class="text-xl font-bold text-slate-800">CallFlow</h1>
                </div>
                <button id="sidebar-toggle" class="text-slate-500 focus:outline-none hover:text-slate-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="p-6">
                <ul class="space-y-1">
                    <li>
                        <a href="#" data-page="dashboard" class="flex items-center p-3 rounded-xl nav-link active">
                            <i class="fas fa-tachometer-alt mr-3 text-indigo-500"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-page="trigger-call" class="flex items-center p-3 rounded-xl nav-link">
                            <i class="fas fa-phone-alt mr-3 text-indigo-500"></i>
                            <span>Trigger Call</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-page="call-history" class="flex items-center p-3 rounded-xl nav-link">
                            <i class="fas fa-history mr-3 text-indigo-500"></i>
                            <span>Call History</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-page="reports" class="flex items-center p-3 rounded-xl nav-link">
                            <i class="fas fa-chart-bar mr-3 text-indigo-500"></i>
                            <span>Reports</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-page="analytics" class="flex items-center p-3 rounded-xl nav-link">
                            <i class="fas fa-chart-pie mr-3 text-indigo-500"></i>
                            <span>Analytics</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-page="logs" class="flex items-center p-3 rounded-xl nav-link">
                            <i class="fas fa-terminal mr-3 text-indigo-500"></i>
                            <span>Logs</span>
                        </a>
                    </li>
                    <li class="pt-4 mt-4 border-t sidebar-divider">
                        <a href="#" data-page="settings" class="flex items-center p-3 rounded-xl nav-link">
                            <i class="fas fa-cog mr-3 text-indigo-500"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                    <li>
                        <button id="logout-btn" class="w-full flex items-center p-3 rounded-xl nav-link text-left">
                            <i class="fas fa-sign-out-alt mr-3 text-indigo-500"></i>
                            <span>Logout</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
        
        <!-- Mobile Sidebar Toggle -->
        <button id="mobile-sidebar-toggle" class="fixed top-4 left-4 z-50 light-button text-slate-700 p-3 rounded-full shadow-lg md:hidden focus:outline-none">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Main Content -->
        <div id="page-content" class="min-h-screen ml-0 md:ml-64 transition-all duration-300">
            <!-- Header -->
            <header class="light-card shadow-sm">
                <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                    <h1 id="page-title" class="text-lg font-semibold text-slate-800">Dashboard</h1>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button id="notifications-btn" class="light-button p-2 rounded-full focus:outline-none">
                                <i class="fas fa-bell text-slate-600"></i>
                                <span id="notification-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
                            </button>
                        </div>
                        <div class="flex items-center light-button px-3 py-1 rounded-full">
                            <img class="h-8 w-8 rounded-full" src="https://cdn0.iconfinder.com/data/icons/set-ui-app-android/32/8-512.png" alt="">
                            <span class="ml-2 text-sm font-medium text-slate-700">Admin User</span>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Toast Notifications Container -->
            <div id="toast-container" class="fixed bottom-4 right-4 space-y-2 z-50"></div>
            
            <!-- Page Content -->
            <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="light-card p-6 rounded-2xl stat-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-slate-500">Total Calls Today</p>
                                    <h3 id="stat-total-calls" class="text-2xl font-bold text-slate-800">0</h3>

                                </div>
                                <div class="bg-indigo-100 p-3 rounded-full">
                                    <i class="fas fa-phone-alt text-indigo-600"></i>
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-slate-500">+1% from yesterday</p>
                        </div>
                        <div class="light-card p-6 rounded-2xl stat-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-slate-500">Successful Calls</p>
                                    <h3 id="stat-successful-calls" class="text-2xl font-bold text-slate-800">0</h3>

                                </div>
                                <div class="bg-green-100 p-3 rounded-full">
                                    <i class="fas fa-check-circle text-green-600"></i>
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-slate-500">45% success rate</p>
                        </div>
                        <div class="light-card p-6 rounded-2xl stat-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-slate-500">Failed Calls</p>
                                    <h3 id="stat-failed-calls" class="text-2xl font-bold text-slate-800">0</h3>

                                </div>
                                <div class="bg-red-100 p-3 rounded-full">
                                    <i class="fas fa-times-circle text-red-600"></i>
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-slate-500">0.0% failure rate</p>
                        </div>
                        <div class="light-card p-6 rounded-2xl stat-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-slate-500">Avg. Call Duration</p>
                                    <h3 id="stat-call-duration" class="text-2xl font-bold text-slate-800">1:00</h3>

                                </div>
                                <div class="bg-purple-100 p-3 rounded-full">
                                    <i class="fas fa-clock text-purple-600"></i>
                                </div>
                            </div>
                            <p class="mt-2 text-sm text-slate-500">+0:30 from last week</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="light-card p-6 rounded-2xl">
                            <h3 class="text-lg font-medium text-slate-800 mb-4">Recent Activity</h3>
                            <div class="space-y-4">
                                <div class="flex items-start">
                                    <div id="recent-activity" class="space-y-4">

                                        <!-- <i class="fas fa-phone-alt text-indigo-600 text-sm"></i> -->
                                        
                                        
                                    </div>
                                    <!-- <div>
                                        <div id="recent-activity" class="space-y-4">

                                    </div> -->
                                </div>
                                <div class="flex items-start">
                                    <div class="bg-green-100 p-2 rounded-full mr-3">
                                        <i class="fas fa-check-circle text-green-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-slate-800">Call completed successfully</p>
                                        <p class="text-xs text-slate-500">5 minutes ago</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="bg-yellow-100 p-2 rounded-full mr-3">
                                        <i class="fas fa-exclamation-triangle text-yellow-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-slate-800">Call failed - No answer</p>
                                        <p class="text-xs text-slate-500">12 minutes ago</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <!-- <div class="bg-indigo-100 p-2 rounded-full mr-3">
                                        <i class="fas fa-phone-alt text-indigo-600 text-sm"></i>
                                    </div> -->
                                    <!-- <div>
                                        <p class="text-sm font-medium text-slate-800">Call initiated to +1 (555) 987-6543</p>
                                        <p class="text-xs text-slate-500">15 minutes ago</p>
                                    </div> -->
                                </div>
                            </div>
                        </div>


                        
                        <div class="light-card p-6 rounded-2xl">
                            <h3 class="text-lg font-medium text-slate-800 mb-4">Quick Actions</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <button data-page="trigger-call" class="light-button hover:bg-indigo-50 p-4 rounded-xl flex flex-col items-center transition border border-indigo-100">
                                    <i class="fas fa-phone-alt text-xl mb-2 text-indigo-600"></i>
                                    <span class="text-sm text-slate-700">Trigger Call</span>
                                </button>
                                <button data-page="call-history" class="light-button hover:bg-indigo-50 p-4 rounded-xl flex flex-col items-center transition border border-indigo-100">
                                    <i class="fas fa-history text-xl mb-2 text-indigo-600"></i>
                                    <span class="text-sm text-slate-700">Call History</span>
                                </button>
                                <button data-page="reports" class="light-button hover:bg-indigo-50 p-4 rounded-xl flex flex-col items-center transition border border-indigo-100">
                                    <i class="fas fa-file-export text-xl mb-2 text-indigo-600"></i>
                                    <span class="text-sm text-slate-700">Generate Report</span>
                                </button>
                                <button data-page="settings" class="light-button hover:bg-indigo-50 p-4 rounded-xl flex flex-col items-center transition border border-indigo-100">
                                    <i class="fas fa-cog text-xl mb-2 text-indigo-600"></i>
                                    <span class="text-sm text-slate-700">Settings</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Trigger Call Page -->
                <div id="trigger-call-page" class="page-content hidden">
                    <div class="light-card rounded-2xl p-6">
                        <h2 class="text-xl font-semibold text-slate-800 mb-6">Trigger Outbound Call</h2>
                        <form id="trigger-call-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="call-name" class="block text-sm font-medium text-slate-700 mb-1">Name</label>
                                    <input type="text" id="call-name" required
                                        class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                </div>
                                <div>
                                    <label for="call-phone" class="block text-sm font-medium text-slate-700 mb-1">Phone Number</label>
                                    <input type="tel" id="call-phone" required
                                        class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="call-policy" class="block text-sm font-medium text-slate-700 mb-1">Policy Number</label>
                                    <input type="text" id="call-policy" required
                                        class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                </div>
                                <div>
                                    <label for="call-plan" class="block text-sm font-medium text-slate-700 mb-1">Plan Name</label>
                                    <input type="text" id="call-plan" required
                                        class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="call-amount" class="block text-sm font-medium text-slate-700 mb-1">Premium Amount</label>
                                    <input type="number" step="100" id="call-amount" required
                                        class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                </div>
                                <div>
                                    <label for="call-currency" class="block text-sm font-medium text-slate-700 mb-1">Currency</label>
                                    <select id="call-currency" required
                                        class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                        <option value="PHP" selected>PHP</option>
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                        <option value="GBP">GBP</option>
                                        <option value="CAD">CAD</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="call-due-date" class="block text-sm font-medium text-slate-700 mb-1">Due Date</label>
                                    <input type="date" id="call-due-date" required
                                        class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                </div>
                            </div>
                            <div class="pt-4">
                                <button type="submit" class="primary-button px-6 py-3 text-white rounded-xl hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Trigger Call
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Call History Page -->
                <div id="call-history-page" class="page-content hidden">
                    <div class="light-card rounded-2xl p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold text-slate-800">Call History</h2>
                            <div class="flex space-x-2">
                                <div class="relative">
                                    <input type="text" placeholder="Search..."
                                        class="light-input pl-8 pr-4 py-2 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                    <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                                </div>
                                <select class="light-input border border-slate-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                    <option>All Status</option>
                                    <option>Completed</option>
                                    <option>Failed</option>
                                    <option>No Answer</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="light-table min-w-full divide-y divide-slate-200 rounded-xl">
                                <thead class="bg-slate-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Timestamp</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Phone</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Policy #</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Duration</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-200" id="call-history-body">
                                    <!-- Call history rows will be inserted here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="flex items-center justify-between mt-4">
                            <div class="text-sm text-slate-500">
                                Showing <span id="call-start">1</span> to <span id="call-end">10</span> of <span id="call-total">24</span> calls
                            </div>
                            <div class="flex space-x-2">
                                <button class="light-button px-3 py-1 rounded-xl border border-slate-200 disabled:opacity-50" disabled>
                                    Previous
                                </button>
                                <button class="light-button px-3 py-1 rounded-xl border border-slate-200">
                                    Next
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Page -->
                <div id="reports-page" class="page-content hidden">
                    <div class="light-card rounded-2xl p-6">
                        <h2 class="text-xl font-semibold text-slate-800 mb-6">Generate Reports</h2>
                        <form id="report-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="report-start-date" class="block text-sm font-medium text-slate-700 mb-1">Start Date</label>
                                    <input type="date" id="report-start-date" required
                                        class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                </div>
                                <div>
                                    <label for="report-end-date" class="block text-sm font-medium text-slate-700 mb-1">End Date</label>
                                    <input type="date" id="report-end-date" required
                                        class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                </div>
                            </div>
                            <div>
                                <label for="report-type" class="block text-sm font-medium text-slate-700 mb-1">Report Type</label>
                                <select id="report-type" required
                                    class="light-input mt-1 block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                    <option value="summary">Summary Report</option>
                                    <option value="detailed">Detailed Call Log</option>
                                    <option value="success">Success Rate Analysis</option>
                                    <option value="duration">Duration Analysis</option>
                                </select>
                            </div>
                            <div class="pt-4 flex space-x-4">
                                <button
                                  type="submit"
                                  class="primary-button px-6 py-3 text-white rounded-xl hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                >
                                  Generate PDF Report
                                </button>
                                <button
                                  type="button"
                                  id="download-recordings-btn"
                                  class="px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                >
                                  Download Recordings
                                </button>
                              </div>
                              
                        </form>
                    </div>
                </div>
                
                <!-- Analytics Page -->
                <div id="analytics-page" class="page-content hidden">
                    <div class="light-card rounded-2xl p-6">
                        <h2 class="text-xl font-semibold text-slate-800 mb-6">Analytics Dashboard</h2>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="light-card p-4 rounded-2xl">
                                <h3 class="text-lg font-medium text-slate-800 mb-4">Calls Per Day (Last 30 Days)</h3>
                                <canvas id="calls-per-day-chart" height="300"></canvas>
                            </div>
                            <div class="light-card p-4 rounded-2xl">
                                <h3 class="text-lg font-medium text-slate-800 mb-4">Call Success Rate</h3>
                                <canvas id="success-rate-chart" height="300"></canvas>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="light-card p-4 rounded-2xl">
                                <h3 class="text-lg font-medium text-slate-800 mb-4">Call Duration Distribution</h3>
                                <canvas id="duration-distribution-chart" height="300"></canvas>
                            </div>
                            <div class="light-card p-4 rounded-2xl">
                                <h3 class="text-lg font-medium text-slate-800 mb-4">Call Outcomes</h3>
                                <canvas id="call-outcomes-chart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Logs Page -->
                <div id="logs-page" class="page-content hidden">
                    <div class="light-card rounded-2xl p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold text-slate-800">System Logs</h2>
                            <div class="flex space-x-2">
                                <button id="refresh-logs" class="light-button px-3 py-1 rounded-xl border border-slate-200 text-slate-700 hover:bg-slate-50">
                                    <i class="fas fa-sync-alt mr-1"></i> Refresh
                                </button>
                                <select id="log-level" class="light-input border border-slate-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                    <option value="all">All Levels</option>
                                    <option value="error">Errors Only</option>
                                    <option value="warning">Warnings</option>
                                    <option value="info">Info</option>
                                </select>
                            </div>
                        </div>
                        <div class="light-card p-4 rounded-xl">
                            <div id="logs-container" class="h-96 overflow-y-auto font-mono text-sm">
                                <!-- Logs will be inserted here by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Page -->
                <div id="settings-page" class="page-content hidden">
                    <div class="light-card rounded-2xl p-6">
                        <h2 class="text-xl font-semibold text-slate-800 mb-6">Account Settings</h2>
                        <form id="settings-form" class="space-y-6">
                            <div>
                                <h3 class="text-lg font-medium text-slate-800 mb-4">User Credentials</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="twilio-sid" class="block text-sm font-medium text-slate-700 mb-1">User ID</label>
                                        <div class="mt-1 relative rounded-xl">
                                            <input type="text" id="twilio-sid" required
                                                class="light-input block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                <span class="text-slate-400 sm:text-sm">*****7890</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="twilio-token" class="block text-sm font-medium text-slate-700 mb-1">CallDashboardAuth</label>
                                        <div class="mt-1 relative rounded-xl">
                                            <input type="password" id="twilio-token" required
                                                class="light-input block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                <span class="text-slate-400 sm:text-sm">*****abcd</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-medium text-slate-800 mb-4">User auth-state</h3>
                                <div>
                                    <label for="voicebot-key" class="block text-sm font-medium text-slate-700 mb-1">User token</label>
                                    <div class="mt-1 relative rounded-xl">
                                        <input type="password" id="voicebot-key" required
                                            class="light-input block w-full px-4 py-3 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
                                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                            <span class="text-slate-400 sm:text-sm">*****xyz1</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="pt-4">
                                <button type="submit" class="primary-button px-6 py-3 text-white rounded-xl hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Save Settings
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>
        
        <!-- Call Detail Modal -->
        <div id="call-detail-modal" class="fixed inset-0 z-50 overflow-y-auto hidden">
            <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-black bg-opacity-30 backdrop-filter backdrop-blur-sm"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="light-modal inline-block align-bottom rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                    <div class="px-6 pt-6 pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-lg leading-6 font-medium text-slate-800" id="modal-title">Call Details</h3>
                                    <button id="close-modal" class="text-slate-500 hover:text-slate-700 focus:outline-none">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="mt-4">
                                    <div class="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <p class="text-sm font-medium text-slate-500">Phone Number</p>
                                            <p id="modal-phone" class="mt-1 text-sm text-slate-800">+1 (555) 123-4567</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-slate-500">Policy Number</p>
                                            <p id="modal-policy" class="mt-1 text-sm text-slate-800">POL-2023-98765</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-slate-500">Status</p>
                                            <p id="modal-status" class="mt-1 text-sm text-slate-800">Completed</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-slate-500">Duration</p>
                                            <p id="modal-duration" class="mt-1 text-sm text-slate-800">2:45</p>
                                        </div>
                                    </div>
                                    <div class="border-t border-slate-200 pt-4">
                                        <div class="flex space-x-4 mb-4">
                                            <button id="play-audio-btn" class="primary-button px-4 py-2 text-white rounded-xl hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                <i class="fas fa-play mr-2"></i> Play Recording
                                            </button>
                                            <button id="show-transcript-btn" class="light-button px-4 py-2 rounded-xl border border-slate-200 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                <i class="fas fa-scroll mr-2"></i> Show Transcript
                                            </button>
                                        </div>
                                        <div id="audio-player-container" class="hidden mb-4">
                                            <audio id="call-audio" controls class="w-full rounded-xl">
                                                Your browser does not support the audio element.
                                            </audio>
                                        </div>
                                        <div id="transcript-container" class="hidden">
                                            <h4 class="text-md font-medium text-slate-800 mb-2">Transcript</h4>
                                            <div id="call-transcript" class="light-card p-4 rounded-xl mb-4 text-sm text-slate-700">
                                                Loading transcript...
                                            </div>
                                            <h4 class="text-md font-medium text-slate-800 mb-2">Summary</h4>
                                            <div id="call-summary" class="light-card p-4 rounded-xl text-sm text-slate-700">
                                                Loading summary...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="px-6 py-3 flex flex-row-reverse">
                        <button type="button" id="close-modal-btn" class="light-button mt-3 w-full inline-flex justify-center rounded-xl border border-slate-200 shadow-sm px-4 py-2 bg-white text-base font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // State management
        const state = {
            authenticated: false,
            currentPage: 'dashboard',
            callHistory: [],
            logs: [],
            settings: {
                twilioSid: 'xx',
                twilioToken: '1234567890abcdef1234567890abcdef',
                voicebotKey: 'sk-1234567890abcdef1234567890abcdef'
            }
        };
        
        // DOM Elements
        const elements = {
            loginPage: document.getElementById('login-page'),
            appContainer: document.getElementById('app-container'),
            authState: document.getElementById('auth-state'),
            loginForm: document.getElementById('login-form'),
            logoutBtn: document.getElementById('logout-btn'),
            sidebarToggle: document.getElementById('sidebar-toggle'),
            mobileSidebarToggle: document.getElementById('mobile-sidebar-toggle'),
            sidebar: document.getElementById('sidebar'),
            pageContent: document.getElementById('page-content'),
            pageTitle: document.getElementById('page-title'),
            toastContainer: document.getElementById('toast-container'),
            // Pages
            pages: {
                dashboard: document.getElementById('dashboard-page'),
                'trigger-call': document.getElementById('trigger-call-page'),
                'call-history': document.getElementById('call-history-page'),
                reports: document.getElementById('reports-page'),
                analytics: document.getElementById('analytics-page'),
                logs: document.getElementById('logs-page'),
                settings: document.getElementById('settings-page')
            },
            // Forms
            triggerCallForm: document.getElementById('trigger-call-form'),
            reportForm: document.getElementById('report-form'),
            settingsForm: document.getElementById('settings-form'),
            // Call history
            callHistoryBody: document.getElementById('call-history-body'),
            // Logs
            logsContainer: document.getElementById('logs-container'),
            refreshLogs: document.getElementById('refresh-logs'),
            logLevel: document.getElementById('log-level'),
            // Modal
            callDetailModal: document.getElementById('call-detail-modal'),
            closeModal: document.getElementById('close-modal'),
            closeModalBtn: document.getElementById('close-modal-btn'),
            modalPhone: document.getElementById('modal-phone'),
            modalPolicy: document.getElementById('modal-policy'),
            modalStatus: document.getElementById('modal-status'),
            modalDuration: document.getElementById('modal-duration'),
            playAudioBtn: document.getElementById('play-audio-btn'),
            showTranscriptBtn: document.getElementById('show-transcript-btn'),
            audioPlayerContainer: document.getElementById('audio-player-container'),
            callAudio: document.getElementById('call-audio'),
            transcriptContainer: document.getElementById('transcript-container'),
            callTranscript: document.getElementById('call-transcript'),
            callSummary: document.getElementById('call-summary')
        };
        
        // Initialize the application
        function init() {
            // Check authentication state
            checkAuth();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize charts
            initCharts();
            
            // Load mock data
            loadMockData();
        }
        
        // Check authentication state
        function checkAuth() {
            const storedAuth = localStorage.getItem('CallDashboardAuth');
            if (storedAuth) {
                try {
                    const authData = JSON.parse(storedAuth);
                    if (authData.authenticated && authData.expires > Date.now()) {
                        state.authenticated = true;
                        showApp();
                        navigateTo(state.currentPage);
                        return;
                    }
                } catch (e) {
                    console.error('Error parsing auth data', e);
                }
            }
                        
            // Not authenticated
            state.authenticated = false;
            showLogin();
        }
        
        // Show login page
        function showLogin() {
            elements.loginPage.classList.remove('hidden');
            elements.appContainer.classList.add('hidden');
        }
        
        // Show app
        function showApp() {
            elements.loginPage.classList.add('hidden');
            elements.appContainer.classList.remove('hidden');
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Login form
            elements.loginForm.addEventListener('submit', handleLogin);
            
            // Logout button
            elements.logoutBtn.addEventListener('click', handleLogout);
            
            // Sidebar toggle
            elements.sidebarToggle.addEventListener('click', toggleSidebar);
            elements.mobileSidebarToggle.addEventListener('click', toggleSidebar);
            
            // Navigation links
            document.querySelectorAll('[data-page]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    navigateTo(page);
                    
                    // Update active state
                    document.querySelectorAll('.nav-link').forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    link.classList.add('active');
                });
            });
            
            // Forms
            elements.triggerCallForm.addEventListener('submit', handleTriggerCall);
            elements.reportForm.addEventListener('submit', handleGenerateReport);
            elements.settingsForm.addEventListener('submit', handleSaveSettings);
            
            // Logs
            elements.refreshLogs.addEventListener('click', refreshLogs);
            elements.logLevel.addEventListener('change', filterLogs);
            
            // Modal
            elements.closeModal.addEventListener('click', closeModal);
            elements.closeModalBtn.addEventListener('click', closeModal);
            elements.playAudioBtn.addEventListener('click', toggleAudioPlayer);
            elements.showTranscriptBtn.addEventListener('click', toggleTranscript);
        }
        
        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Simple validation for demo purposes
            if (email === 'allianz@test.com' && password === 'Test1234') {
                // Set auth state with expiration (1 hour)
                const authData = {
                    authenticated: true,
                    expires: Date.now() + (60 * 60 * 1000)
                };
                localStorage.setItem('callDashboardAuth', JSON.stringify(authData));
                                
                state.authenticated = true;
                showApp();
                navigateTo('dashboard');
                showToast('Login successful', 'success');
            } else {
                showToast('Invalid credentials', 'error');
            }
        }
        
        // Handle logout
        function handleLogout() {
            localStorage.removeItem('callDashboardAuth');
            state.authenticated = false;
            showLogin();
            showToast('Logged out successfully', 'success');
        }
        
        // Toggle sidebar
        function toggleSidebar() {
            elements.sidebar.classList.toggle('hidden');
            elements.pageContent.classList.toggle('md:ml-64');
        }
        
        // Navigate to page
        function navigateTo(page) {
            // Hide all pages
            Object.values(elements.pages).forEach(pageEl => {
                pageEl.classList.add('hidden');
            });
            
            // Show selected page
            elements.pages[page].classList.remove('hidden');
            state.currentPage = page;
            
            // Update page title
            const pageTitles = {
                dashboard: 'Dashboard',
                'trigger-call': 'Trigger Call',
                'call-history': 'Call History',
                reports: 'Reports',
                analytics: 'Analytics',
                logs: 'System Logs',
                settings: 'Account Settings'
            };
            elements.pageTitle.textContent = pageTitles[page];
            
            // Load data if needed
            if (page === 'call-history') {
                renderCallHistory();
            } else if (page === 'logs') {
                renderLogs();
            } else if (page === 'settings') {
                loadSettings();
            }
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast px-4 py-3 rounded-xl shadow-md ${
                type === 'error' ? 'bg-red-500 text-white' : 
                type === 'success' ? 'bg-green-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            toast.textContent = message;
                        
            elements.toastContainer.appendChild(toast);
                        
            // Remove toast after animation
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Handle trigger call form
        function handleTriggerCall(e) {
            e.preventDefault();
                        
            // Get form values
            const callData = {
                name: document.getElementById('call-name').value,
                phone: document.getElementById('call-phone').value,
                policy: document.getElementById('call-policy').value,
                plan: document.getElementById('call-plan').value,
                amount: document.getElementById('call-amount').value,
                currency: document.getElementById('call-currency').value,
                dueDate: document.getElementById('call-due-date').value
            };
            function getRandomDuration() {
                const totalSeconds = Math.floor(Math.random() * (300 - 30 + 1)) + 30; // random between 30s and 300s
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }

            
            // In a real app, you would make an API call here
            // For demo, we'll simulate a successful call
            axios.post('http://localhost:5000/trigger-call', callData)
                .then(response => {
                    showToast('Call has been queued successfully', 'success');
                    elements.triggerCallForm.reset();

                    // add the new call as "queued"
                    const sid = response.data.sid;
                    const newCall = {
                    sid:       sid,
                    timestamp: new Date().toISOString(),
                    phone:     callData.phone,
                    policy:    callData.policy,
                    status:    'completed',
                    duration:   '0:00'

                    };
                    state.callHistory.unshift(newCall);
                    if (state.currentPage === 'call-history') renderCallHistory();

                    // poll every 5s until Twilio updates our status
                    const poller = setInterval(() => {
                    axios.get('http://localhost:5000/call-history')
                        .then(res => {
                        // replace local callHistory with the backend’s truth
                        state.callHistory = res.data;
                        if (state.currentPage === 'call-history') renderCallHistory();

                        // once we see “completed” for our SID, stop polling
                        const me = state.callHistory.find(c=>c.sid===sid);
                        if (me && me.status==='completed') {
                            clearInterval(poller);
                            loadDashboardStats();
                            loadRecentActivity();
                        }
                        })
                        .catch(err => {
                        console.error('poll error', err);
                        clearInterval(poller);
                        });
                    }, 5000);

                })
                .catch(error => {
                    console.error('Call trigger failed:', error);
                    showToast('Failed to trigger call', 'error');
                });
            }

        
        // Handle generate report
        async function handleGenerateReport(e) {
            e.preventDefault();

            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            const reportType = document.getElementById('report-type').value;

            try {
                const response = await fetch('http://localhost:5000/generate-report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ startDate, endDate, reportType })
                });

                if (!response.ok) {
                    const data = await response.json();
                    showToast(data.error || 'Report generation failed', 'error');
                    return;
                }

                const blob = await response.blob();
                const fileURL = URL.createObjectURL(blob);

                const link = document.createElement('a');
                link.href = fileURL;
                link.download = `Call_Report_${startDate}_to_${endDate}.pdf`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showToast('PDF report generated and downloaded successfully', 'success');
            } catch (err) {
                console.error('Report error:', err);
                showToast('Something went wrong while generating the report', 'error');
            }
        }


        // Handle save settings
        function handleSaveSettings(e) {
            e.preventDefault();
                        
            // Get form values
            const settings = {
                twilioSid: document.getElementById('twilio-sid').value,
                twilioToken: document.getElementById('twilio-token').value,
                voicebotKey: document.getElementById('voicebot-key').value
            };
            
            // In a real app, you would make an API call here
            // For demo, we'll simulate a successful save
            setTimeout(() => {
                showToast('Settings saved successfully', 'success');
                state.settings = settings;
            }, 800);
        }
        
        // Load settings into form
        function loadSettings() {
            document.getElementById('twilio-sid').value = state.settings.twilioSid;
            document.getElementById('twilio-token').value = state.settings.twilioToken;
            document.getElementById('voicebot-key').value = state.settings.voicebotKey;
        }
        
        // Render call history
        function renderCallHistory() {
            elements.callHistoryBody.innerHTML = '';
                        
            state.callHistory.forEach(call => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-slate-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${formatDate(call.timestamp)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800">${call.phone}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${call.policy}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            call.status === 'completed' ? 'bg-green-100 text-green-800' :
                            call.status === 'failed' ? 'bg-red-100 text-red-800' :
                            'bg-yellow-100 text-yellow-800'
                        }">
                            ${call.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${call.duration}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button data-call-id="${call.id}" class="text-indigo-600 hover:text-indigo-900 mr-3 call-detail-btn">Details</button>
                    </td>
                `;
                elements.callHistoryBody.appendChild(row);
            });
            
            // Add event listeners to detail buttons
            document.querySelectorAll('.call-detail-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                // Always pull from the button itself, not whatever was clicked inside it:
                const callId = e.currentTarget.getAttribute('data-call-id');

                // And use the correct variable name:
                showCallDetails(callId);
            });
            });
        }

        
        // Show call details modal
        function showCallDetails(callId) {
            const call = state.callHistory.find(c => c.id === callId);
            if (!call) return;
            
            // Update modal content
            elements.modalPhone.textContent = call.phone;
            elements.modalPolicy.textContent = call.policy;
            elements.modalStatus.textContent = call.status;
            elements.modalDuration.textContent = call.duration;
            
            // Reset modal state
            elements.audioPlayerContainer.classList.add('hidden');
            elements.transcriptContainer.classList.add('hidden');
            elements.callAudio.src = '';
            elements.callTranscript.textContent = 'Loading transcript...';
            elements.callSummary.textContent = 'Loading summary...';
            
            // Set up audio player (mock URL for demo)
            if (call.status === 'completed') {
                elements.callAudio.src = 'https://example.com/recordings/sample.mp3';
                elements.playAudioBtn.classList.remove('hidden');
            } else {
                elements.playAudioBtn.classList.add('hidden');
            }
            
            // Show modal
            elements.callDetailModal.classList.remove('hidden');
        }
        
        // Close modal
        function closeModal() {
            elements.callDetailModal.classList.add('hidden');
            elements.callAudio.pause();
        }
        
        // Toggle audio player
        function toggleAudioPlayer() {
            elements.audioPlayerContainer.classList.toggle('hidden');
            if (!elements.audioPlayerContainer.classList.contains('hidden')) {
                elements.callAudio.play();
            } else {
                elements.callAudio.pause();
            }
        }
        
        // Toggle transcript
        function toggleTranscript() {
            elements.transcriptContainer.classList.toggle('hidden');
            if (!elements.transcriptContainer.classList.contains('hidden')) {
                // Simulate loading transcript and summary
                setTimeout(() => {
                    elements.callTranscript.innerHTML = `
                        <p><strong>Agent:</strong> Hello, this is Sarah calling from Insurance Corp about your policy renewal.</p>
                        <p><strong>Customer:</strong> Hi Sarah, yes I've been expecting this call.</p>
                        <p><strong>Agent:</strong> Great! I see your policy #POL-2023-98765 is due for renewal on ${formatDate(new Date().toISOString())}.</p>
                        <p><strong>Customer:</strong> That's correct. What's the premium amount this year?</p>
                        <p><strong>Agent:</strong> The annual premium is $1,200, same as last year with no increase.</p>
                        <p><strong>Customer:</strong> Perfect, I'll go ahead with the renewal then.</p>
                    `;
                                    
                    elements.callSummary.innerHTML = `
                        <p>Customer confirmed renewal of policy #POL-2023-98765 for $1,200.</p>
                        <p>Payment method on file will be charged on ${formatDate(new Date().toISOString())}.</p>
                        <p>Customer expressed satisfaction with the premium amount remaining unchanged.</p>
                    `;
                }, 800);
            }
        }
        
        // Refresh logs
        function refreshLogs() {
            // In a real app, you would fetch logs from the API
            // For demo, we'll just re-render the existing logs
            renderLogs();
            showToast('Logs refreshed', 'success');
        }
        
        // Filter logs by level
        function filterLogs() {
            renderLogs();
        }
        
        // Render logs
        function renderLogs() {
            elements.logsContainer.innerHTML = '';
                        
            const levelFilter = elements.logLevel.value;
                        
            state.logs.forEach(log => {
                if (levelFilter !== 'all' && log.level !== levelFilter) return;
                                
                const logEntry = document.createElement('div');
                logEntry.className = `py-2 px-2 rounded ${log.level === 'error' ? 'highlight-error' : ''}`;
                                
                const timestamp = document.createElement('span');
                timestamp.className = 'text-slate-500 mr-2';
                timestamp.textContent = formatDateTime(log.timestamp);
                                
                const level = document.createElement('span');
                level.className = log.level === 'error' ? 'error-text font-medium' : 
                                  log.level === 'warning' ? 'warning-text font-medium' : 
                                  'text-slate-700';
                level.textContent = `[${log.level.toUpperCase()}]`;
                                
                const message = document.createElement('span');
                message.className = 'ml-2 text-slate-700';
                message.textContent = log.message;
                                
                logEntry.appendChild(timestamp);
                logEntry.appendChild(level);
                logEntry.appendChild(message);
                                
                elements.logsContainer.appendChild(logEntry);
            });
        }
        
        // Initialize charts
        function initCharts() {
            // Custom chart colors for light morphism
            const chartColors = {
                background: 'rgba(255, 255, 255, 0.8)',
                border: 'rgba(226, 232, 240, 0.8)',
                pointBackground: 'rgba(255, 255, 255, 0.9)',
                pointBorder: 'rgba(226, 232, 240, 0.9)'
            };
            
            // Calls per day chart
            const callsPerDayCtx = document.getElementById('calls-per-day-chart').getContext('2d');
            new Chart(callsPerDayCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 30}, (_, i) => {
                        const date = new Date();
                        date.setDate(date.getDate() - (29 - i));
                        return date.toLocaleDateString('en-US', {month: 'short', day: 'numeric'});
                    }),
                    datasets: [{
                        label: 'Calls per day',
                        data: Array.from({length: 30}, () => Math.floor(Math.random() * 30) + 5),
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderColor: 'rgba(99, 102, 241, 0.8)',
                        borderWidth: 2,
                        tension: 0.1,
                        pointBackgroundColor: 'rgba(255, 255, 255, 0.9)',
                        pointBorderColor: 'rgba(99, 102, 241, 1)',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(226, 232, 240, 0.5)'
                            },
                            ticks: {
                                color: 'rgba(100, 116, 139, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(226, 232, 240, 0.5)'
                            },
                            ticks: {
                                color: 'rgba(100, 116, 139, 0.7)'
                            }
                        }
                    }
                }
            });
            
            // Success rate chart
            const successRateCtx = document.getElementById('success-rate-chart').getContext('2d');
            new Chart(successRateCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Success', 'Failure'],
                    datasets: [{
                        data: [75, 25],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'rgba(100, 116, 139, 0.8)'
                            }
                        }
                    }
                }
            });
            
            // Duration distribution chart
            const durationCtx = document.getElementById('duration-distribution-chart').getContext('2d');
            new Chart(durationCtx, {
                type: 'bar',
                data: {
                    labels: ['<1 min', '1-2 min', '2-3 min', '3-4 min', '4-5 min', '>5 min'],
                    datasets: [{
                        label: 'Call Duration',
                        data: [10, 25, 30, 20, 10, 5],
                        backgroundColor: 'rgba(139, 92, 246, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(226, 232, 240, 0.5)'
                            },
                            ticks: {
                                color: 'rgba(100, 116, 139, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(226, 232, 240, 0.5)'
                            },
                            ticks: {
                                color: 'rgba(100, 116, 139, 0.7)'
                            }
                        }
                    }
                }
            });
            
            // Call outcomes chart
            const outcomesCtx = document.getElementById('call-outcomes-chart').getContext('2d');
            new Chart(outcomesCtx, {
                type: 'pie',
                data: {
                    labels: ['Payment Collected', 'Left Voicemail', 'No Answer', 'Call Failed', 'Other'],
                    datasets: [{
                        data: [40, 25, 20, 10, 5],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(156, 163, 175, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(245, 158, 11, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'rgba(100, 116, 139, 0.8)'
                            }
                        }
                    }
                }
            });
        }
        
        // Load mock data
        function loadMockData() {
            // Mock call history
            for (let i = 0; i < 24; i++) {
                const daysAgo = Math.floor(Math.random() * 30);
                const date = new Date();
                date.setDate(date.getDate() - daysAgo);
                                
                const statuses = ['completed', 'failed', 'no answer', 'busy'];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                                
                const duration = status === 'completed' ? 
                    `${Math.floor(Math.random() * 5)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}` : 
                    '0:00';
                                
                state.callHistory.push({
                    id: `call-${i}`,
                    timestamp: date.toISOString(),
                    phone: `+1 (555) ${Math.floor(100 + Math.random() * 900)}-${Math.floor(1000 + Math.random() * 9000)}`,
                    policy: `POL-2023-${Math.floor(10000 + Math.random() * 90000)}`,
                    status: status,
                    duration: '1:00'
                });
            }
            
            // Mock logs
            const logLevels = ['info', 'warning', 'error'];
            const logMessages = [
                'Call initiated to +1 (555) 123-4567',
                'Call completed successfully',
                'Call failed - No answer',
                'Twilio API request completed',
                'voicebot response received',
                'Database connection established',
                'Error processing call request',
                'Warning: Call duration exceeded threshold',
                'System maintenance scheduled',
                'New call recording available'
            ];
            
            for (let i = 0; i < 100; i++) {
                const hoursAgo = Math.floor(Math.random() * 24);
                const minutesAgo = Math.floor(Math.random() * 60);
                const date = new Date();
                date.setHours(date.getHours() - hoursAgo);
                date.setMinutes(date.getMinutes() - minutesAgo);
                                
                state.logs.push({
                    timestamp: date.toISOString(),
                    level: logLevels[Math.floor(Math.random() * logLevels.length)],
                    message: logMessages[Math.floor(Math.random() * logMessages.length)]
                });
            }
            
            // Sort logs by timestamp (newest first)
            state.logs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        }
        
        // Format date for display
        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

    function loadDashboardStats() {
        axios.get('http://localhost:5000/call-stats')
        .then(response => {
            const stats = response.data;
            document.getElementById('stat-total-calls').textContent = stats.today || 0;
            document.getElementById('stat-successful-calls').textContent = stats.successful || 0;
            document.getElementById('stat-failed-calls').textContent = stats.failed || 0;
            document.getElementById('stat-call-duration').textContent = stats.duration || "0:00";
        })
        .catch(error => {
            console.error('Failed to load dashboard stats:', error);
        });
    }
    window.onload = loadDashboardStats;


    // Load stats on page load
    window.addEventListener('DOMContentLoaded', () => {
        loadDashboardStats();
        loadRecentActivity();
        loadCallHistory();
        document.getElementById('report-form').addEventListener('submit', handleGenerateReport);
        document.getElementById('download-recordings-btn').addEventListener('click', handleDownloadRecordings);

    

    });

    function loadRecentActivity() {
        axios.get('http://localhost:5000/recent-activity')
            .then(res => {
                const activityList = document.getElementById('recent-activity');
                activityList.innerHTML = '';

                res.data.forEach(call => {
                    const li = document.createElement('div');
                    li.className = 'flex items-start';

                    let bgClass = '';
                    let iconClass = '';

                    if (call.status === 'queued') {
                        bgClass = 'bg-indigo-100';
                        iconClass = 'fas fa-phone-alt text-indigo-600';
                    } else if (call.status === 'completed') {
                        bgClass = 'bg-green-100';
                        iconClass = 'fas fa-check-circle text-green-600';
                    } else if (call.status === 'failed') {
                        bgClass = 'bg-yellow-100';
                        iconClass = 'fas fa-exclamation-triangle text-yellow-600';
                    }

                    const relativeTime = timeAgo(new Date(call.timestamp));
                    const statusText = `Call ${call.status} to ${call.phone}`;

                    li.innerHTML = `
                        <div class="${bgClass} p-2 rounded-full mr-3">
                            <i class="${iconClass} text-sm"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-slate-800">${statusText}</p>
                            <p class="text-xs text-slate-500">${relativeTime}</p>
                        </div>
                    `;
                    activityList.appendChild(li);
                });
            })
            .catch(err => console.error('Failed to load activity:', err));
    }

    
    async function handleDownloadRecordings() {
      console.log('🔽 download clicked');
      const startDate = document.getElementById('report-start-date').value;
      const endDate   = document.getElementById('report-end-date').value;
      try {
        const res = await fetch('http://localhost:5000/download-recordings', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ startDate, endDate })
        });
        if (!res.ok) {
          const err = await res.json();
          return alert(err.error || 'Download failed');
        }
        const blob = await res.blob();
        downloadBlob(blob, `recordings_${startDate}_to_${endDate}.zip`);
      } catch (err) {
        console.error(err);
        alert('Download error');
      }
    }

    function downloadBlob(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a   = document.createElement('a');
      a.href    = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }


    function timeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        const mins = Math.floor(seconds / 60);
        if (mins < 1) return 'just now';
        if (mins === 1) return '1 minute ago';
        return `${mins} minutes ago`;
    }

    window.onload = loadRecentActivity;


        function timeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        const mins = Math.floor(seconds / 60);
        if (mins < 1) return 'just now';
        if (mins === 1) return '1 minute ago';
        return `${mins} minutes ago`;
        }





        
        // Format date and time for display
        function formatDateTime(isoString) {
            const date = new Date(isoString);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    
    function renderCallTable(calls) {
        const tableBody = document.querySelector('#call-history-table tbody');
        tableBody.innerHTML = ''; // clear previous rows

        calls.forEach(call => {
            const date = new Date(call.timestamp);
            const formattedDate = date.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric',
            year: 'numeric'
            });

            const durationMin = Math.floor(call.duration / 60);
            const durationSec = call.duration % 60;
            const duration = `${durationMin}:${durationSec.toString().padStart(2, '0')}`;

            const row = `
            <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formattedDate}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${call.phone}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${call.policy || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${call.status}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${duration}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                <button data-call-id="${call.sid}" class="text-blue-600 hover:underline call-detail-btn">Details</button>
                </td>
            </tr>
            `;
            tableBody.insertAdjacentHTML('beforeend', row);
        });
        }


    function loadCallHistory() {
        fetch('http://localhost:5000/call-history')
            .then(resp => resp.json())
            .then(calls => {
            console.log("📞 call_log:", calls);           // <-- prints to browser console
            renderCallHistoryTable(calls);                // <-- renders into your HTML table
            })
            .catch(err => console.error("Failed to load call history:", err));
        }

        // call this when the page loads or when you navigate to Call History
        loadCallHistory();


    </script>
</body>
</html>